# Название workflow для GitHub Actions
name: Deploy to GitHub Pages

# Триггеры запуска workflow
on:
  push:
    branches:
      - master
  # Возможность запуска вручную через интерфейс GitHub
  workflow_dispatch: 

# Права доступа для workflow
permissions:
  contents: read
  pages: write
  id-token: write

# Управление параллельными запусками
concurrency:
  group: "pages"              # Группа для ограничения параллельных деплоев
  cancel-in-progress: false   # Не отменять текущий деплой при новом push

# Определение задач
jobs:
  # Задача сборки сайта
  build:
    runs-on: ubuntu-latest    # ОС для выполнения (Ubuntu Linux)
    steps:
      # Шаг 1: Получение кода из репозитория
      - name: Checkout repository
        uses: actions/checkout@v4

      # Шаг 2: Установка Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'  # Версия Python
          cache: 'pip'

      # Шаг 3: Установка зависимостей проекта
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip  # Обновление pip
          pip install -r requirements.txt       # Установка зависимостей из файла

      # Шаг 4: Сборка статического сайта с помощью MkDocs
      - name: Build site
        run: mkdocs build  # Генерирует HTML файлы в папку ./site

      # Шаг 5: Настройка GitHub Pages
      - name: Setup Pages
        uses: actions/configure-pages@v4

      # Шаг 6: Загрузка собранного сайта как артефакт
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./site  # Путь к собранному сайту

  # Задача деплоя на GitHub Pages
  deploy:
    environment:
      name: github-pages  # Имя окружения для деплоя
      url: ${{ steps.deployment.outputs.page_url }}  # URL деплоя
    runs-on: ubuntu-latest
    needs: build  # Зависимость: деплой выполняется только после успешной сборки
    steps:
      # Деплой артефакта на GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
